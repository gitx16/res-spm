define("value/datagrid/1.0.0/datagrid",["$","gallery/backbone/1.1.0/backbone","gallery/underscore/1.5.2/underscore","value/datasource/1.0.0/datasource","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events","value/base/1.0.0/base","arale/templatable/0.9.2/templatable","gallery/handlebars/1.0.2/handlebars","arale/widget/1.1.1/widget","value/form-text/1.0.0/form-text","value/form/1.0.0/form-widget","gallery/handlebars/1.0.2/runtime","./data-grid-text.handlebars","value/form-select/1.0.0/form-select","jquery/select2/3.5.2/select2-zh-cn","./data-grid-select.handlebars","value/form-buttons/1.0.0/form-buttons","./data-grid-buttons.handlebars","value/form-radio-label/1.0.0/form-radio","value/form-checkbox/1.0.0/form-checkbox","./grid-item/grid-item","./grid-item/grid-item.handlebars","value/paginator/1.0.0/paginator","./data-grid.handlebars"],function(t){"use strict";var a,e=t("$"),r=t("gallery/backbone/1.1.0/backbone").history,n=t("value/datasource/1.0.0/datasource"),i=t("value/base/1.0.0/base"),l=t("value/form-text/1.0.0/form-text"),s=t("./data-grid-text.handlebars"),o=t("value/form-select/1.0.0/form-select"),c=t("./data-grid-select.handlebars"),d=t("value/form-buttons/1.0.0/form-buttons"),p=t("./data-grid-buttons.handlebars"),h=t("value/form-radio-label/1.0.0/form-radio"),u=t("value/form-checkbox/1.0.0/form-checkbox"),f=t("./grid-item/grid-item"),g=t("value/paginator/1.0.0/paginator"),b=t("./data-grid.handlebars"),v={},m=function(){return r.fragment},y={},x=i.extend({attrs:{parentNode:null,template:b,model:{},url:"",urlIds:[],queryParams:{},hasPaginator:!0,paginatorCfg:{targetPage:1,pageSize:15,symbolMapping:{previous:'<span class="glyphicon glyphicon-arrow-left"></span> 上一页',next:'下一页 <span class="glyphicon glyphicon-arrow-right"></span>'}},tableCfg:{cols:[]}},paginator:null,tableBtns:null,groupBtns:null,$searchGroup:null,$filterGroup:null,formWidgets:{},searchDOM:null,events:{"keyup input.keywords":function(t){13===t.which&&this.doSearch()},"click input:checkbox,input:radio,.radio-label":function(){this.doSearch()},"click .top-operation .btn-group a":function(t){var a=this,r=e(t.currentTarget),n=r.data("btnkey"),i=this.groupBtns[n];i&&i.action&&i.action.call(a,r)}},initAttrs:function(t,a){x.superclass.initAttrs.call(this,t,a),v[this.cid]=this,this.setModel(),this._initDataSource(),this.setSearchDataStorage()},setSearchDataStorage:function(){var t=m();a=y[t]||{}},registerWidget:function(t,a){a.set("dataGrid",this),this.formWidgets[t]=a},getWidget:function(t){return this.formWidgets[t]},setModel:function(){var t={cid:this.cid,topOperation:this.get("topOperation"),tableCfg:this.get("tableCfg")};this.set("model",t)},setup:function(){this.$searchGroup=this.$("div.search-group"),this.$filterGroup=this.$("div.filter-group");var t=this.get("topOperation");t&&(this._initTopOperation(),this._convertGroupBtns()),this._convertTableBtns(),this.initPaginator(),x.superclass.setup.call(this)},initPaginator:function(){var t=this,a=this.get("hasPaginator");a&&(this.paginator=new g({parentNode:this.$("div.paginator-wrapper"),pageClick:function(a){t.doSearch(a)}}))},_convertTableBtns:function(){var t=this.get("tableCfg");t.operators&&(this.tableBtns=t.operators.btnMap)},_convertGroupBtns:function(){var t=this.get("topOperation"),a=t.btnsGroup,e={};a&&a.forEach(function(t){t.btnkey&&(e[t.btnkey]=t)}),this.groupBtns=e},_initTopOperation:function(){var t=this.get("topOperation"),a=t.searchGroup,e=t.filtersGroup;a&&this._initSearchGroup(a),e&&this._initFiltersGroup(e)},_initSearchGroup:function(t){var a=this;a.insertSearchText(t),a.insertSearchSelect(t),a.insertSeachBtn(t)},insertSearchText:function(t){var e=this;if(t.input){var r=t.input.name,n=decodeURIComponent(a[r]||""),i=new l({template:s,name:r,value:n,nodeData:t.input.nodeData,needEncode:!0});e.insertSearchWidget(r,i)}},insertSearchSelect:function(t){var r=this;if(t.select){var n=t.select.name,i=new o(e.extend(!0,t.select,{selected:a[n],addNullChoice:t.select.addNullChoice,template:c}));r.insertSearchWidget(n,i)}},insertSeachBtn:function(t){var a=this;if(t.searchBtn){var e="data-grid-btn",r=new d({template:p,btns:[{btnkey:e,text:"搜索",fa:"fa-search",type:"default",handler:function(){a.doSearch()}}]});a.insertSearchWidget(e,r)}},insertSearchWidget:function(t,a){var e=this;e.registerWidget(t,a),e.$searchGroup.append(a.element)},_initFiltersGroup:function(t){var e=this;t.forEach(function(t){var r,n=t.name,i=t.type;if(t.checked=t.checked||a[n],"radio"==i)r=new h(t);else{if("checkbox"!=i)return seajs.log("过滤组type错误："+i,"error"),void 0;r=new u(t)}e.registerWidget(n,r),e.$filterGroup.append(r.element)})},_initDataSource:function(){var t=this,a=this.get("url"),r=this.get("urlIds"),i=this.dataSource=new n({source:function(n,i){e.extend(!0,n,t.get("queryParams")),e.eduAjax({url:a,ids:r,rest:"get",data:n,done:function(t){i(t)}})}});i.on("data",this._setResult.bind(t))},getSearchData:function(){var t={},a=this.formWidgets;return Object.keys(a).forEach(function(r){e.extend(t,a[r].getValue())}),t},_setResult:function(t){this.data=t,this.renderTable(t.collection),this.renderPagination(t)},reResult:function(){this._setResult(this.data)},renderTable:function(t){var a=this,r=a.get("tableCfg"),n=r.cols,i=e.getDocFragment();t.length?t.forEach(function(t){new f({parentNode:i,tableCfg:r,itemData:t})}):i.append('<tr><td colspan="'+(n.length+1)+'"><div class="">查询无结果</div></td></tr>'),this.$("tbody").empty().append(i)},renderPagination:function(t){var a=this.get("hasPaginator");a&&this.paginator.set("renderData",{totalCount:t.totalCount,currentPage:t.currentPage,totalPages:t.totalPages})},doSearch:function(t){t=t||1;var a=this.getSearchData();a.currentPage=t,this.recordSearchData(a),this.dataSource.getData(a)},recordSearchData:function(t){var e=m();a=y[e]=t},fetch:function(){this.doSearch(a.currentPage||1)}});return x}),define("value/datagrid/1.0.0/data-grid-text.handlebars",["gallery/handlebars/1.0.2/runtime"],function(t,a,e){var r=t("gallery/handlebars/1.0.2/runtime"),n=r.template;e.exports=n(function(t,a,e,r,n){function i(t,a){var e,r="";return r+=d((e=a.key,typeof e===c?e.apply(t):e))+'="'+d(typeof t===c?t.apply(t):t)+'"'}this.compilerInfo=[3,">= 1.0.0-rc.4"],e=e||{};for(var l in t.helpers)e[l]=e[l]||t.helpers[l];n=n||{};var s,o="",c="function",d=this.escapeExpression,p=this;return o+='<div class="search-item">\r\n    <input type="text" class="form-control keywords" name="',(s=e.name)?s=s.call(a,{hash:{},data:n}):(s=a.name,s=typeof s===c?s.apply(a):s),o+=d(s)+'" value="',(s=e.value)?s=s.call(a,{hash:{},data:n}):(s=a.value,s=typeof s===c?s.apply(a):s),o+=d(s)+'" ',s=e.each.call(a,a.nodeData,{hash:{},inverse:p.noop,fn:p.program(1,i,n),data:n}),(s||0===s)&&(o+=s),o+=" />\r\n</div>"})}),define("value/datagrid/1.0.0/data-grid-select.handlebars",["gallery/handlebars/1.0.2/runtime"],function(t,a,e){var r=t("gallery/handlebars/1.0.2/runtime"),n=r.template;e.exports=n(function(t,a,e,r,n){function i(t,a,r){var n,i,l,s="";return s+='\r\n            <option value="',(n=e.value)?n=n.call(t,{hash:{},data:a}):(n=t.value,n=typeof n===c?n.apply(t):n),s+=d(n)+'" ',l={hash:{},data:a},s+=d((n=e.dealSelected,n?n.call(t,t.value,r.selected,l):p.call(t,"dealSelected",t.value,r.selected,l)))+">",(i=e.label)?i=i.call(t,{hash:{},data:a}):(i=t.label,i=typeof i===c?i.apply(t):i),s+=d(i)+"</option>\r\n        "}this.compilerInfo=[3,">= 1.0.0-rc.4"],e=e||{};for(var l in t.helpers)e[l]=e[l]||t.helpers[l];n=n||{};var s,o="",c="function",d=this.escapeExpression,p=e.helperMissing,h=this;return o+='<div class="search-item">\r\n    <select class="form-control">\r\n        ',s=e.each.call(a,a.dataList,{hash:{},inverse:h.noop,fn:h.programWithDepth(1,i,n,a),data:n}),(s||0===s)&&(o+=s),o+="\r\n    </select>\r\n</div>"})}),define("value/datagrid/1.0.0/data-grid-buttons.handlebars",["gallery/handlebars/1.0.2/runtime"],function(t,a,e){var r=t("gallery/handlebars/1.0.2/runtime"),n=r.template;e.exports=n(function(t,a,e,r,n){function i(t,a){var r,n="";return n+='\r\n        <button type="button" class="btn btn-',(r=e.type)?r=r.call(t,{hash:{},data:a}):(r=t.type,r=typeof r===c?r.apply(t):r),n+=d(r)+' search-btn" data-btnkey="',(r=e.btnkey)?r=r.call(t,{hash:{},data:a}):(r=t.btnkey,r=typeof r===c?r.apply(t):r),n+=d(r)+'"><li class="fa ',(r=e.fa)?r=r.call(t,{hash:{},data:a}):(r=t.fa,r=typeof r===c?r.apply(t):r),n+=d(r)+'"></li>',(r=e.text)?r=r.call(t,{hash:{},data:a}):(r=t.text,r=typeof r===c?r.apply(t):r),n+=d(r)+"</button>\r\n    "}this.compilerInfo=[3,">= 1.0.0-rc.4"],e=e||{};for(var l in t.helpers)e[l]=e[l]||t.helpers[l];n=n||{};var s,o="",c="function",d=this.escapeExpression,p=this;return o+='<div class="search-item">\r\n    ',s=e.each.call(a,a.btns,{hash:{},inverse:p.noop,fn:p.program(1,i,n),data:n}),(s||0===s)&&(o+=s),o+="\r\n</div>\r\n"})}),define("value/datagrid/1.0.0/grid-item/grid-item",["$","gallery/handlebars/1.0.2/runtime","value/base/1.0.0/base","arale/templatable/0.9.2/templatable","gallery/handlebars/1.0.2/handlebars","arale/widget/1.1.1/widget","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events"],function(t){"use strict";var a=t("$"),e=t("gallery/handlebars/1.0.2/runtime"),r=t("value/base/1.0.0/base"),n=t("value/datagrid/1.0.0/grid-item/grid-item.handlebars"),i={btnText:"button",type:"default",size:"xs",action:function(){seajs.log("按钮事件未指定","warn")}},l=r.extend({attrs:{template:n,model:{},itemData:{},tableCfg:{}},btnMap:{},events:{"click button,.dropdown-menu a":function(t){var e=this,r=a(t.currentTarget),n=r.data("btnkey"),i=this.get("itemData"),l=e.btnMap,s=l[n];s&&s.action&&s.action.call(e,i,r)}},initAttrs:function(t,a){l.superclass.initAttrs.call(this,t,a),this.setBtnMap(),this.setModel()},setModel:function(){var t=this.get("model");t.tableCfg=this.get("tableCfg"),t.itemData=this.get("itemData"),t.btnList=this.getGridBtns()},setBtnMap:function(){function t(t){t.btnTextRet=a.result(t.btnText,e,e.get("itemData"))}var e=this,r=this.get("tableCfg");if(r.operators){var n=r.operators.btnMap;Object.keys(n).forEach(function(e){var r=n[e]=a.extend({},i,n[e]);t(r);var l=r.dropdownItems;l&&l.length&&l.forEach(t)}),this.btnMap=r.operators.btnMap}},updateSelf:function(){this.setBtnMap();var t=this.get("model");t.btnList=this.getGridBtns(),this.renderPartial()},getGridBtns:function(){var t=this.get("tableCfg"),a=t.operators;if(a){var e=this.btnMap,r=a.btnsFilter,n=r.call(this.get("itemData")),i=n.map(function(t){var a=e[t];return a.btnkey=t,a});return i}},templateHelpers:{renderItemData:function(t,a){function r(a,e){return e?e(a,t):a}var n="",i=a.cols;return i.forEach(function(a){var e=t[a.title]?t[a.title]:"",i=["<td class="+a.tdClass+" title="+e+">",r(t[a.property],a.format),"</td>"];n+=i.join("")}),new e.SafeString(n)}}});return l}),define("value/datagrid/1.0.0/grid-item/grid-item.handlebars",["gallery/handlebars/1.0.2/runtime"],function(t,a,e){var r=t("gallery/handlebars/1.0.2/runtime"),n=r.template;e.exports=n(function(t,a,e,r,n){function i(t,a,r){var n,i="";return i+="\n        <td>\n            ",n=e.each.call(t,r.btnList,{hash:{},inverse:v.noop,fn:v.program(2,l,a),data:a}),(n||0===n)&&(i+=n),i+="\n        </td>\n    "}function l(t,a){var r,n="";return n+="\n                ",r=e["if"].call(t,t.dropdown,{hash:{},inverse:v.program(6,c,a),fn:v.program(3,s,a),data:a}),(r||0===r)&&(n+=r),n+="\n            "}function s(t,a){var r,n="";return n+='\n                    <div class="btn-group">\n                        <a href="javascript:void(0)" class="btn btn-',(r=e.type)?r=r.call(t,{hash:{},data:a}):(r=t.type,r=typeof r===g?r.apply(t):r),n+=b(r)+" btn-",(r=e.size)?r=r.call(t,{hash:{},data:a}):(r=t.size,r=typeof r===g?r.apply(t):r),n+=b(r)+' dropdown-toggle" data-toggle="dropdown">\n                            ',(r=e.btnTextRet)?r=r.call(t,{hash:{},data:a}):(r=t.btnTextRet,r=typeof r===g?r.apply(t):r),n+=b(r)+'\n                            <span class="caret"></span>\n                        </a>\n                        <ul class="dropdown-menu">\n\n                        ',r=e.each.call(t,t.dropdownItems,{hash:{},inverse:v.noop,fn:v.program(4,o,a),data:a}),(r||0===r)&&(n+=r),n+="\n                        </ul>\n                    </div>\n                "}function o(t,a){var r,n="";return n+='\n                            <li>\n                                <a href="javascript:void(0)" data-btnkey="',(r=e.btnkey)?r=r.call(t,{hash:{},data:a}):(r=t.btnkey,r=typeof r===g?r.apply(t):r),n+=b(r)+'">',(r=e.btnTextRet)?r=r.call(t,{hash:{},data:a}):(r=t.btnTextRet,r=typeof r===g?r.apply(t):r),(r||0===r)&&(n+=r),n+="</a>\n                            </li>\n                        "}function c(t,a){var r,n="";return n+='\n                <button type="button" class="btn btn-',(r=e.size)?r=r.call(t,{hash:{},data:a}):(r=t.size,r=typeof r===g?r.apply(t):r),n+=b(r)+" btn-",(r=e.type)?r=r.call(t,{hash:{},data:a}):(r=t.type,r=typeof r===g?r.apply(t):r),n+=b(r)+'" data-btnkey="',(r=e.btnkey)?r=r.call(t,{hash:{},data:a}):(r=t.btnkey,r=typeof r===g?r.apply(t):r),n+=b(r)+'" >',(r=e.btnTextRet)?r=r.call(t,{hash:{},data:a}):(r=t.btnTextRet,r=typeof r===g?r.apply(t):r),n+=b(r)+"</button>&nbsp;\n                "}this.compilerInfo=[3,">= 1.0.0-rc.4"],e=e||{};for(var d in t.helpers)e[d]=e[d]||t.helpers[d];n=n||{};var p,h,u,f="",g="function",b=this.escapeExpression,v=this,m=e.helperMissing;return f+="<tr>\n    ",u={hash:{},data:n},f+=b((p=e.renderItemData,p?p.call(a,a.itemData,a.tableCfg,u):m.call(a,"renderItemData",a.itemData,a.tableCfg,u)))+"\n\n    ",h=e["if"].call(a,(p=a.tableCfg,null==p||p===!1?p:p.operators),{hash:{},inverse:v.noop,fn:v.programWithDepth(1,i,n,a),data:n}),(h||0===h)&&(f+=h),f+="\n</tr>\n"})}),define("value/datagrid/1.0.0/data-grid.handlebars",["gallery/handlebars/1.0.2/runtime"],function(t,a,e){var r=t("gallery/handlebars/1.0.2/runtime"),n=r.template;e.exports=n(function(t,a,e,r,n){function i(t,a){var r,n,i="";return i+='\r\n        <div class="top-operation">\r\n            \r\n            ',n=e["if"].call(t,(r=t.topOperation,null==r||r===!1?r:r.btnsGroup),{hash:{},inverse:m.noop,fn:m.program(2,l,a),data:a}),(n||0===n)&&(i+=n),i+="\r\n            \r\n            ",n=e["if"].call(t,(r=t.topOperation,null==r||r===!1?r:r.searchGroup),{hash:{},inverse:m.noop,fn:m.program(5,o,a),data:a}),(n||0===n)&&(i+=n),i+="\r\n            \r\n            ",n=e["if"].call(t,(r=t.topOperation,null==r||r===!1?r:r.filtersGroup),{hash:{},inverse:m.noop,fn:m.program(7,c,a),data:a}),(n||0===n)&&(i+=n),i+="\r\n        </div>\r\n    "}function l(t,a){var r,n,i="";return i+='\r\n                <div class="btn-group pull-right">\r\n                    ',n=e.each.call(t,(r=t.topOperation,null==r||r===!1?r:r.btnsGroup),{hash:{},inverse:m.noop,fn:m.program(3,s,a),data:a}),(n||0===n)&&(i+=n),i+="\r\n                </div>\r\n            "}function s(t,a){var r,n="";return n+='\r\n                        <a class="btn btn-default" href="',(r=e.href)?r=r.call(t,{hash:{},data:a}):(r=t.href,r=typeof r===b?r.apply(t):r),n+=v(r)+'" data-btnkey="',(r=e.btnkey)?r=r.call(t,{hash:{},data:a}):(r=t.btnkey,r=typeof r===b?r.apply(t):r),n+=v(r)+'"><li class="fa ',(r=e.fa)?r=r.call(t,{hash:{},data:a}):(r=t.fa,r=typeof r===b?r.apply(t):r),n+=v(r)+'"></li>',(r=e.text)?r=r.call(t,{hash:{},data:a}):(r=t.text,r=typeof r===b?r.apply(t):r),n+=v(r)+"</a>\r\n                    "}function o(){return'\r\n                <div class="clearfix">\r\n                    <div class="search-group"></div>\r\n                </div>\r\n            '}function c(){return'\r\n                <div class="filter-group form-horizontal">\r\n                </div>\r\n            '}function d(t,a){var r,n="";return n+='\r\n                    <th width="',(r=e.width)?r=r.call(t,{hash:{},data:a}):(r=t.width,r=typeof r===b?r.apply(t):r),n+=v(r)+'">',(r=e.text)?r=r.call(t,{hash:{},data:a}):(r=t.text,r=typeof r===b?r.apply(t):r),n+=v(r)+"</th>\r\n                "}function p(t){var a,e="";return e+='\r\n                    <th width="'+v((a=t.tableCfg,a=null==a||a===!1?a:a.operators,a=null==a||a===!1?a:a.col,a=null==a||a===!1?a:a.width,typeof a===b?a.apply(t):a))+'">'+v((a=t.tableCfg,a=null==a||a===!1?a:a.operators,a=null==a||a===!1?a:a.col,a=null==a||a===!1?a:a.text,typeof a===b?a.apply(t):a))+"</th>\r\n                "}this.compilerInfo=[3,">= 1.0.0-rc.4"],e=e||{};for(var h in t.helpers)e[h]=e[h]||t.helpers[h];n=n||{};var u,f,g="",b="function",v=this.escapeExpression,m=this;return g+='<div class="data-grid">\r\n    ',u=e["if"].call(a,a.topOperation,{hash:{},inverse:m.noop,fn:m.program(1,i,n),data:n}),(u||0===u)&&(g+=u),g+='\r\n    <div class="datagrid-result mrgb10">\r\n        <table class="table table-striped table-hover">\r\n            <thead>\r\n            <tr>\r\n                ',f=e.each.call(a,(u=a.tableCfg,null==u||u===!1?u:u.cols),{hash:{},inverse:m.noop,fn:m.program(9,d,n),data:n}),(f||0===f)&&(g+=f),g+="\r\n                ",f=e["if"].call(a,(u=a.tableCfg,null==u||u===!1?u:u.operators),{hash:{},inverse:m.noop,fn:m.program(11,p,n),data:n}),(f||0===f)&&(g+=f),g+='\r\n            </tr>\r\n            </thead>\r\n\r\n            <tbody>\r\n            </tbody>\r\n\r\n        </table>\r\n        <div class="paginator-wrapper pull-right"></div>\r\n    </div>\r\n</div>'})});
